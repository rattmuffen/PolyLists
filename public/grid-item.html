<!DOCTYPE html>
<link rel="import" href="bower_components/paper-card/paper-card.html">
<link rel="import" href="bower_components/paper-item/paper-item.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">
<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="bower_components/paper-button/paper-button.html">
<link rel="import" href="bower_components/iron-signals/iron-signals.html">

<dom-module id="grid-item">
	<style>
		paper-card {
			margin-top: 20px;
			transform: translateZ(0) /* Fixes column rendering bug */
		}
		
		#list-description {
			font-size: 18px;
		}
		
		#list-actions {
			text-align: right;
		}
		
		#new-item-input {
			margin-top: -20px;
		}
		
		#card-items {
			display:table;
			border-collapse:collapse;
			
		}
		
		#item-body {
			display: table-cell;
			width: 100%;
			padding-left: 10px;
		}
		
		#add-button {
			
		}
	</style>

    <template>
		<paper-card heading="{{title}}" image="{{image}}" elevation="2">
			<div id="list-description" class="card-content"><i>{{description}}</i></div>
			<template is="dom-repeat" items="[[items]]">
				<paper-item id="card-items" class="card-actions">
					<paper-item-body id="item-body">
						<div>{{item.text}}</div>
					</paper-item-body>
					<paper-icon-button class="item-button" icon="clear" title="Remove item" on-click="removeItem">
					</paper-icon-button>
				</paper-item>
			</template>
			<div class="card-actions">
				<paper-input id="new-item-input" label="New item" type="text" bind-value="{{text}}">
					<paper-icon-button suffix icon="add" title="Add item" on-click="submitItem">
					</paper-icon-button>
				</paper-input>
			</div>
			<div id="list-actions" class="card-actions">
				<paper-button title="Remove list" on-click="removeList">Delete list</paper-button>
			</div>
		</paper-card>
    </template>

	<script>
		Polymer({
			is: "grid-item",
			properties: {
				listid: {
					type: String
				},
				title: {
					type: String
				},
				description: {
					type: String
				},
				image: {
					type: String
				},
				items: {
					type: Array
				},
				text: {
					type: String
				},
			},
			submitItem: function() {
				console.log('Submit item to list ' + this.title);
				var query = {'id': this.listid, 'text': this.text};
				
				//TODO reset variables here.
				
				// Post query to server.
				$.post('add/item', query, function(data) {
					// Fire updated data event.
					document.querySelector('#newListDialog').fire('iron-signal', {'name': 'update', 'data': data});
				});
			},
			removeItem: function(e) {
				var id = e.model.item.id;
				
				console.log('Remove item ' + id + 'from list ' + this.title);
				var query = {'id': id, 'listid': this.listid};
				
				// Post query to server.
				$.post('remove/item', query, function(data) {
					// Fire updated data event.
					document.querySelector('#newListDialog').fire('iron-signal', {'name': 'update', 'data': data});
				});
			},
			removeList: function(e) {
				console.log('Remove list ' + this.title);
				var query = {'id': this.listid};
				
				// Post query to server.
				$.post('remove/list', query, function(data) {
					// Fire updated data event.
					document.querySelector('#newListDialog').fire('iron-signal', {'name': 'update', 'data': data});
				});
			}
		});
	</script>
</dom-module>