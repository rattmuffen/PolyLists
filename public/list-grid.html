<!DOCTYPE html>
<link rel="import" href="bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="bower_components/paper-toast/paper-toast.html">
<link rel="import" href="bower_components/juicy-tile-list/dist/juicy-tile-list.html">

<link rel="import" href="grid-item.html">

<dom-module id="list-grid">
	<style>
		.list-grid-item {
			width: 400px;
			float: left;
		}
	</style>

    <template>
		<!-- Auto fetch lists from server -->
		<iron-ajax auto url="get/lists" handle-as="json" on-response="response"></iron-ajax>

		<juicy-tile-list id="listgrid"
						 defaultTileSetup="{'precalculateHeight': true, 'width': '400px'}">
			<template is="dom-repeat" items="[[data]]">
				<grid-item class="list-grid-item"
						   listid="{{item.id}}"
						   title="{{item.title}}"
						   image="{{item.image}}"
						   items="{{item.items}}"
						   checkable="{{item.checkable}}"
						   color="{{item.color}}"
						   description="{{item.description}}">
				</grid-item> 
			</template>
		</juicy-tile-list>
		<paper-toast duration="2000" text=""></paper-toast>
    </template>
	
	<script>
		Polymer({
			is: "list-grid",
			ready: function () {
				this.data = [];
			},
			response: function(request) {
				this.data =  request.detail.response;
				console.log(this.data)
			},
			update: function(data) {
				// Set lists.
				this.data = data.lists;
				
				// Show toast with update info.
				var updateEvent = data.event;
				$('paper-toast').prop('text', updateEvent);
				$('paper-toast')[0].show();
			}
		});
		
		var socket = io();
		socket.on('update-data', function(data) {
			console.log('Recieved data update.');
			$('#list-grid')[0].update(JSON.parse(data));
		});
	</script>
</dom-module>